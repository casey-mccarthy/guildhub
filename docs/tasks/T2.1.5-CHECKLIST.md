# Task T2.1.5: Add Discord Login Button - Checklist

**Epic:** 2 - Discord OAuth Authentication
**Story Points:** 1
**Time Estimate:** 2 hours
**Status:** Completed

## Overview

Add a prominent "Login with Discord" button to the home page with proper styling and user state display.

**Prerequisites:** T2.1.4 completed (OAuth callback controller implemented)

---

## Acceptance Criteria

- [x] Discord login button added to home page
- [x] Button styled with Discord brand colors
- [x] Discord logo included in button
- [x] User info displayed when logged in
- [x] Logout button shown for authenticated users
- [x] Admin badge displayed for admin users
- [x] System tests written

---

## What Was Implemented

### 1. Home Page Updates

**File:** `app/views/home/index.html.erb`

**Features:**

**Not Signed In:**
- Large "Login with Discord" button
- Official Discord logo (SVG)
- Discord brand colors (blurple)
- Hover effects and animations
- Helper text: "Sign in with your Discord account to get started"

**Signed In:**
- User info card with:
  - Discord avatar (or placeholder with first letter)
  - Display name (username#discriminator or email)
  - Admin badge (if admin)
  - Logout button

### 2. Tailwind CSS Updates

**File:** `app/assets/stylesheets/application.tailwind.css`

**Discord Brand Colors Added:**
```css
--color-discord-blurple: #5865F2;       /* Discord primary */
--color-discord-blurple-dark: #4752C4;  /* Discord hover */
--color-discord-green: #57F287;         /* Discord success */
--color-discord-red: #ED4245;           /* Discord error */
```

**Usage:**
```html
class="bg-discord-blurple hover:bg-discord-blurple-dark"
```

### 3. System Tests

**File:** `spec/system/discord_authentication_spec.rb`

**Test Coverage:**
- Login button visibility (not signed in)
- Discord logo display
- Helper text display
- User info display (signed in)
- Avatar display (with image and placeholder)
- Logout button display
- Admin badge display
- Complete OAuth flow test

**Total:** 12 test cases

---

## UI Components

### Login Button (Not Signed In)

```erb
<%= link_to "/auth/discord", class: "inline-flex items-center bg-discord-blurple hover:bg-discord-blurple-dark text-white font-bold px-8 py-4 rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105" do %>
  <!-- Discord Logo SVG -->
  <svg class="w-8 h-8 mr-3" ...>
    <!-- Discord logo path -->
  </svg>
  <span class="text-xl">Login with Discord</span>
<% end %>
```

**Features:**
- Discord brand color (#5865F2)
- Official Discord logo
- Smooth hover animation (scale 1.05)
- Shadow for depth
- Large, prominent button

### User Card (Signed In)

```erb
<div class="inline-block bg-white rounded-lg shadow-lg p-6 max-w-md">
  <div class="flex items-center space-x-4">
    <!-- Avatar -->
    <% if current_user.discord_avatar_url %>
      <%= image_tag current_user.discord_avatar(size: 64), class: "w-16 h-16 rounded-full" %>
    <% else %>
      <!-- Placeholder with first letter -->
      <div class="w-16 h-16 rounded-full bg-everquest-blue ...">
        <%= current_user.display_name[0].upcase %>
      </div>
    <% end %>

    <!-- User info -->
    <div class="text-left">
      <p class="text-lg font-semibold"><%= current_user.display_name %></p>

      <!-- Admin badge -->
      <% if current_user.admin? %>
        <span class="bg-everquest-gold text-white text-xs px-2 py-1 rounded font-semibold">
          ADMIN
        </span>
      <% end %>
    </div>
  </div>

  <!-- Logout button -->
  <div class="mt-4 pt-4 border-t">
    <%= button_to "Logout", logout_path, method: :delete, class: "btn-secondary w-full" %>
  </div>
</div>
```

**Features:**
- Discord avatar (64x64 rounded)
- Fallback placeholder (first letter)
- Display name (username#1234 or email)
- Admin badge (gold on white)
- Logout button

---

## Discord Branding Guidelines

Following Discord's official brand guidelines:

### Colors
- **Primary (Blurple):** `#5865F2`
- **Hover:** `#4752C4`
- **Success (Green):** `#57F287`
- **Error (Red):** `#ED4245`

### Logo
- Official Discord SVG logo included
- White color on colored background
- Proper spacing and sizing

### Button Text
- "Login with Discord" (recommended by Discord)
- Not "Sign in with Discord" or "Discord Login"

### Resources
- Discord Brand Guidelines: https://discord.com/branding
- Discord SVG Assets: https://discord.com/branding

---

## Testing

### Run System Tests

```bash
# Run Discord authentication tests
bundle exec rspec spec/system/discord_authentication_spec.rb

# Run with JavaScript driver (for full interactivity)
bundle exec rspec spec/system/discord_authentication_spec.rb --tag js

# Run all system tests
bundle exec rspec spec/system/

# Run with documentation format
bundle exec rspec spec/system/discord_authentication_spec.rb --format documentation
```

### Manual Testing

```bash
# Start development server
bin/dev

# Visit home page
open http://localhost:3000
```

**Test Checklist:**
- [ ] Login button is visible (not signed in)
- [ ] Discord logo appears correctly
- [ ] Button has hover effect (color change and scale)
- [ ] Click button redirects to `/auth/discord`
- [ ] After login, user info card appears
- [ ] Avatar displays correctly
- [ ] Display name shows username or email
- [ ] Admin badge shows for admin users
- [ ] Logout button works
- [ ] After logout, login button reappears

---

## User Flow

### First-Time User Login

```
1. User visits home page
   └─> Sees "Login with Discord" button

2. User clicks "Login with Discord"
   └─> Redirects to /auth/discord
   └─> OmniAuth redirects to Discord

3. Discord authorization page
   └─> User clicks "Authorize"

4. Discord redirects back
   └─> /auth/discord/callback
   └─> Auth::CallbacksController#create
   └─> User.from_omniauth creates new user
   └─> Session set: session[:user_id] = user.id

5. Redirect to home page
   └─> User info card displayed
   └─> "Successfully signed in with Discord" notice
```

### Returning User Login

```
1. User visits home page
   └─> Sees "Login with Discord" button

2. User clicks "Login with Discord"
   └─> Redirects to /auth/discord
   └─> OmniAuth redirects to Discord

3. Discord authorization (automatic)
   └─> User already authorized, no prompt

4. Discord redirects back
   └─> User.from_omniauth updates existing user
   └─> Session set

5. Redirect to home page
   └─> User info card displayed
```

### Logout Flow

```
1. User on home page (logged in)
   └─> User info card visible

2. User clicks "Logout" button
   └─> DELETE /logout
   └─> SessionsController#destroy
   └─> reset_session clears user_id

3. Redirect to home page
   └─> "Login with Discord" button visible
   └─> "Successfully signed out" notice
```

---

## Accessibility

### Login Button

```html
<a href="/auth/discord"
   class="..."
   role="button"
   aria-label="Login with Discord">
  <!-- Content -->
</a>
```

### User Avatar

```html
<!-- With image -->
<img src="..."
     alt="testuser#1234"
     class="...">

<!-- Placeholder -->
<div aria-label="testuser#1234">
  T
</div>
```

### Logout Button

```html
<button type="submit"
        form="..."
        class="...">
  Logout
</button>
```

---

## Responsive Design

### Mobile (< 640px)
- Full-width login button
- Stacked user info card
- Large touch targets

### Tablet (640px - 1024px)
- Centered login button
- Inline user info card

### Desktop (> 1024px)
- Maximum width constraints
- Hover effects enabled
- Smooth transitions

---

## Troubleshooting

### Login button not visible

**Solution:**
```bash
# Ensure Tailwind CSS is compiled
yarn build:css

# Restart development server
bin/dev
```

### Discord logo not showing

**Solution:**
- Check SVG markup is valid
- Verify `fill="currentColor"` in SVG path
- Check CSS classes on SVG element

### User info not displaying after login

**Solution:**
```bash
# Check session is set
bin/rails console
> session[:user_id]  # Should return user ID

# Verify current_user helper
> User.find_by(id: session[:user_id])
```

### Avatar not loading

**Solution:**
- Check `discord_avatar_url` in database
- Verify image URL is valid
- Check network tab for 404 errors
- Ensure placeholder logic works:
  ```erb
  <% if current_user.discord_avatar_url %>
    <!-- Image -->
  <% else %>
    <!-- Placeholder -->
  <% end %>
  ```

### Logout button not working

**Solution:**
- Verify route: `DELETE /logout`
- Check button uses `method: :delete`
- Ensure Turbo is configured (or disabled with `data: { turbo: false }`)

---

## Styling Reference

### Discord Button Classes

```css
bg-discord-blurple           /* Discord primary color */
hover:bg-discord-blurple-dark /* Hover state */
text-white                   /* White text */
font-bold                    /* Bold font */
px-8 py-4                    /* Padding */
rounded-lg                   /* Rounded corners */
shadow-lg                    /* Large shadow */
transition-all duration-200  /* Smooth transitions */
transform hover:scale-105    /* Hover scale effect */
```

### User Card Classes

```css
bg-white                     /* White background */
rounded-lg                   /* Rounded corners */
shadow-lg                    /* Large shadow */
p-6                          /* Padding */
max-w-md                     /* Max width */
```

### Avatar Classes

```css
w-16 h-16                    /* 64x64 size */
rounded-full                 /* Circular */
```

### Admin Badge Classes

```css
bg-everquest-gold            /* Gold background */
text-white                   /* White text */
text-xs                      /* Extra small */
px-2 py-1                    /* Small padding */
rounded                      /* Rounded corners */
font-semibold                /* Semi-bold font */
```

---

## Next Steps

After completing T2.1.5:

- ✅ **T2.1.1:** Create Discord Application
- ✅ **T2.1.2:** Configure OmniAuth Discord
- ✅ **T2.1.3:** Create Users migration and model
- ✅ **T2.1.4:** Implement OmniAuth callback controller
- ✅ **T2.1.5:** Add Discord login button ← You are here

**Epic 2.1 Complete! (8 SP)**

⏭️ **Next:** Epic 2.2 - Session Management (3 SP)
- T2.2.1: Implement session handling (already done in T2.1.4)
- T2.2.2: Create logout functionality (already done in T2.1.4)
- T2.2.3: Add user navigation UI

---

## Files Created/Modified

- `app/views/home/index.html.erb` (modified)
- `app/assets/stylesheets/application.tailwind.css` (modified)
- `spec/system/discord_authentication_spec.rb` (created)
- `docs/tasks/T2.1.5-CHECKLIST.md` (created)

---

## References

- **Discord Branding:** https://discord.com/branding
- **Discord OAuth:** https://discord.com/developers/docs/topics/oauth2
- **Tailwind CSS:** https://tailwindcss.com
- **Rails Helpers:** https://guides.rubyonrails.org/layouts_and_rendering.html

---

*Last Updated: October 27, 2025*
