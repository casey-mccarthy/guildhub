#!/usr/bin/env bash
# Test runner for Docker environment
# Usage: bin/test_docker [spec_file]

set -e

echo "ðŸ§ª Running tests in Docker container..."
echo ""

# Setup test database if needed
echo "ðŸ“¦ Ensuring test database exists..."
docker-compose exec web bin/rails db:create RAILS_ENV=test 2>/dev/null || true
docker-compose exec web bin/rails db:migrate RAILS_ENV=test

echo ""
echo "ðŸš€ Running RSpec tests..."
echo ""

if [ -z "$1" ]; then
  # Run all tests
  docker-compose exec web bundle exec rspec --format documentation
else
  # Run specific test file
  docker-compose exec web bundle exec rspec "$1" --format documentation
fi

echo ""
echo "âœ… Tests complete!"
echo ""
echo "ðŸ“Š View coverage report: open coverage/index.html"
